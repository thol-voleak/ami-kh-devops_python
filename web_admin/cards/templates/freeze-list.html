{% extends "base.html" %}
{% load static %}
{% block content %}
<div class="panel mb25">
    <div class="panel-heading border">
        <h3>Card freeze list</h3>
    </div>

     {% for message in messages %}
    <div class="col-xs-12">
        <div class='alert
                    alert-success
                    alert-dismissable' id="msg-add-service">
            <a href="#" class="close" data-dismiss="alert" aria-label="close">Ã—</a>
            <strong>{{ message|capfirst }}</strong>
        </div>
    </div>
    {% endfor %}

    <div class="panel-body">
        <div class="table-responsive">
            <table class="table table-bordered table-striped mb0" id="tbl_card_history">
                <thead>
                <tr>
                    <th id="ticket_id">Ticket ID</th>
                    <th id="rule_action_id">Rule Action ID</th>
                    <th id="Event">Event</th>
                    <th id="Card Id">Card ID</th>
                    <th id="description">Description</th>
                    <th id="start_active_ticket_time">Start freeze time</th>
                    <th id="end_active_ticket_time">End freeze time</th>
                    <th id="created_timestamp">Created date</th>
                    <th id="last_updated_timestamp">Last update date</th>
                    <th id="is_deleted">Deleted</th>
                    <th id="action">Action</th>
                </tr>
                </thead>
                <tbody>
                {% for freezeCard in data %}
                    {% if freezeCard.action == 'unstop card' %}
                           <tr id="row-{{ freezeCard.ticket_id }}">
                            <td class="col-sm-1">{{ freezeCard.ticket_id }}</td>
                            <td class="col-sm-1">{{ freezeCard.rule_action_id }}</td>
                            <td class="col-sm-1">{{ freezeCard.action}}</td>
                            <td class="col-sm-1">{{ freezeCard.card_id}}</td>
                            <td class="col-sm-1">{{ freezeCard.description}}</td>
                            <td class="col-sm-1">{{ freezeCard.start_active_ticket_timestamp}}</td>
                            <td class="col-sm-1">{{ freezeCard.end_active_ticket_timestamp}}</td>
                            <td class="col-sm-1">{{ freezeCard.created_timestamp}}</td>
                            <td class="col-sm-1">{{ freezeCard.last_updated_timestamp}}</td>
                            <td class="col-sm-1">{{ freezeCard.is_deleted}}</td>
                            <td class="col-sm-1">
                                {% if not freezeCard.is_deleted %}
                                    <button type="button"
                            class="btn btn-danger mb5 btn-outline btn-xs"
                            id="freeze-card-btn-delete-{{ freezeCard.ticket_id }}"
                            data-url="{% url 'cards:delete_card_freeze' freezeCard.ticket_id %}"
                            onclick="unFreezeCard('{{ freezeCard.ticket_id }}')">
                            <span class="small">UnFreeze</span>
                            </button>
                                {% endif %}
                           </td>
                        </tr>
                    {% endif %}
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

{% block body_js %}
{{ block.super }}
    <script>

    function unFreezeCard(id) {
        console.log(id);
        swal({
                title: "Are you sure you want to unfreeze card?",
                text: "",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                confirmButtonText: "OK",
                closeOnConfirm: true
            },
            function () {
                var url = $("#freeze-card-btn-delete-" + id).data("url");
                console.log(url);
                $.ajax({
                    url: url,
                    type: "POST",
                    dataType: "json",
                    beforeSend: function (xhr) {
                        xhr.setRequestHeader("X-CSRFToken", '{{ csrf_token }}');
                    },
                    success: function (response) {
                        console.log(response);
                        if (response.status == 1) {
                            // Logout
                            var url = window.location.origin + "/admin-portal/authentications/login/?next=" + window.location.pathname ;
                            window.location.replace(url);
                        } else if (response.status == 2) {
                            // success
                           var url = window.location.origin+"/admin-portal/cards/card-freeze-list/";
                            window.location.replace(url);
                        } else {
                            // Failed
                            showErrorMessage(response.msg);
                        }
                    },
                    error: function (msg) {
                        showErrorMessage(JSON.stringify(msg));
                    }
                });
            });
    }

    </script>
{% endblock %}


