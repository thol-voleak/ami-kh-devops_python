{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="panel mb25">
    <div class="panel-heading border">
        <h3>Source Of Fund Reconcile Report</h3>
    </div>
    <div class="panel-body">
        <form id="submit-form" class="form-horizontal" role="form" method="post"
              {% if  sof_file_id %} action="{% url 'reconcile:reconcile_sof_report_by_file_id' sof_file_id %}"
              {% else %} action="{% url 'reconcile:reconcile_sof_report' %}"
              {% endif %}>
            {% csrf_token %}
            <div class="form-group">
                <label class="col-sm-2 control-label">On us/Off us</label>
                <div class="col-xs-2">
                    <select class="form-control" id="ddl_on_off_us" name="on_off_us_id">
                        <option value=-1 {% if is_on_us == -1 %}selected="selected"{% endif %}>All</option>
                        <option value=1 {% if is_on_us == 1 %}selected="selected"{% endif %}>On</option>
                        <option value=0 {% if is_on_us == 0 %}selected="selected"{% endif %}>Off</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label class="col-sm-2 control-label">Source of fund</label>
                <div class="col-xs-2">
                    <select class="form-control" id="ddl_source_of_fund" name="source_of_fund_id">
                        <option value="bank">Bank</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label class="col-sm-2 control-label">Source of fund partner name</label>
                <div class="col-sm-2">
                    <input type="text" class="form-control input-rounded" name="sof_partner_name_id" id="sof_partner_name_id" value="{{ sof_code }}" />
                </div>
            </div>

            <div class="form-group">
                <label class="col-sm-2 control-label">Currency</label>
                <div class="col-xs-2">
                    <select class="form-control" id="ddl_currency" name="currency_id">
                        <option value="" >All</option>
                        {% for currency in currencies %}
                            <option value="{{ currency.0 }}" {% if currency_id == currency.0 %} selected="selected"{% endif %}>{{ currency.0 }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label class="col-sm-2 control-label">Reconcile status</label>
                <div class="col-xs-2">
                    <select class="form-control" id="ddl_reconcile_status" name="reconcile_status_id">
                        <option value="-1">All</option>
                        <option value="4" {% if reconcile_status_id == 4 %} selected="selected"{% endif %}>Reconciled</option>
                        <option value="6" {% if reconcile_status_id == 6 %} selected="selected"{% endif %}>Unreconciled - Different Amount</option>
                        <option value="7" {% if reconcile_status_id == 7 %} selected="selected"{% endif %}>Unreconciled - Type not match</option>
                        <option value="8" {% if reconcile_status_id == 8 %} selected="selected"{% endif %}>Unreconciled - Only in partner</option>
                        <option value="9" {% if reconcile_status_id == 9 %} selected="selected"{% endif %}>Unreconciled - Only in Equator</option>
                    </select>
                </div>
            </div>

             <div class="form-group">
                <label class="col-sm-2 control-label">Payment type</label>
                <div class="col-xs-2">
                    <select class="form-control" id="ddl_payment_type" name="reconcile_payment_type_id">
                        <option value="" >All</option>
                        <option value="debit" {% if reconcile_payment_type_id == 'debit' %} selected="selected"{% endif %}>Debit</option>
                        <option value="credit" {% if reconcile_payment_type_id == 'credit' %} selected="selected"{% endif %}>Credit</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label class="col-sm-2 control-label">Start date</label>
                <div class="col-sm-2">
                    <input type="date" class="form-control input-rounded"
                           name="from_created_timestamp"
                           value="{{ from_created_timestamp|default_if_none:'' }}"
                           id="dtp_from">
                </div>
                <label class="col-sm-1 control-label">End date</label>
                <div class="col-sm-2">
                    <input type="date" class="form-control input-rounded"
                           name="to_created_timestamp"
                           value="{{ to_created_timestamp|default_if_none:'' }}"
                           id="dtp_to">
                </div>
            </div>
            <input id="current_page_index" name="current_page_index" style="display:none" value="1">
            <div class="form-group">
                <div class="pull-right col-sm-1">
                    <button id="btn_search" class="btn btn-success text-left mb15" type="submit">Search</button>
                </div>
            </div>
        </form>
        <label class="col-sm-12" style="text-align:right"><b>(Total {{ paginator.total_elements }})</b></label>
        <div class="table-responsive">
            <table class="table table-bordered table-striped mb0" id="tbl_sof_report">
                <thead>
                <tr>
                    <th id="id_clm">Order ID/Detail Txn ID</th>
                    <th id="ext_transaction_id_clm">External Transaction ID</th>
                    <th id="transaction_id_clm"> Transaction ID for Reconcile</th>
                    <th id="is_us_on_clm">ON US/OFF US</th>
                    <th id="payment_type_clm">Payment type</th>
                    <th id="payment_type_partner_clm">Payment type from partner</th>
                    <th id="reconcile_date_clm">Reconcilelation Date&time</th>
                    <th id="status_clm">Status</th>
                    <th id="equator_amount_clm">Equator Amount</th>
                    <th id="partner_amount_clmb">Partner Amount</th>
                </tr>
                </thead>
                <tbody id="table_body">
                    {% for report in sof_report %}
                        <tr>
                            <td class="col-sm-2">{{ report.detail_trans_id }}</td>
                            <td class="col-sm-2">{{ report.ext_trans_id }}</td>
                            <td class="col-sm-2">{{ report.authorized_id }}</td>
                            <td class="col-sm-2">{% if report.sof_file.is_on_us %} ON US {% else %} OFF US {% endif %}</td>
                            <td class="col-sm-2">{{ report.payment_type }}</td>
                            <td class="col-sm-2">{{ report.sof_file.sof_code }}</td>
                            <td class="col-sm-2">{{ report.last_updated_timestamp }}</td>
                            <td class="col-sm-2">{{ report.status.name  }}</td>
                            <td class="col-sm-2">{{ report.tmn_amount }}</td>
                            <td class="col-sm-2">{{ report.authorized_amount }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% if paginator.total_pages > 1 %}
            <ul class="list-inline">
                <li><span>Page </span></li>
                {% if page_range.start > 1 %}
                    <li><a class="page_idx">1</a></li>
                    <li><span>...</span></li>
                {% endif %}

                {% for i in page_range %}
                <li>{% if i == paginator.current_page %}<b><u>{% endif %}<a class="page_idx">{{i}}</a>{% if i == paginator.current_page %}</u></b>{% endif %}</li>
                {% endfor %}

                {% if page_range.stop < paginator.total_pages|add:1 %}
                    <li><span>...</span></li>
                    <li><a class="page_idx">{{ paginator.total_pages }}</a></li>
                {% endif %}
            </ul>
        {% endif %}
    </div>
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
<script>
    $(".page_idx").click(function() {
        $("#current_page_index").val($(this).text());
        $("#btn_search").click();
    });
</script>
{% endblock %}
