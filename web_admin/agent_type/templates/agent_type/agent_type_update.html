{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="panel mb25">
    <div class="panel-heading border">
        <h3>Edit Agent Type</h3>
    </div>

    <div class="panel-body">
        <div class="row no-margin">
            <div class="col-lg-12">
                <form id="submit-form" class="form-horizontal" role="form" method="post"
                      action="{% url 'agent_type:agent-type-update' agent_type_info.id %}">
                    {% csrf_token %}
                    <div class="form-group">
                        <label class="col-sm-2 control-label">Agent Type *</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control input-rounded" name="agent_type_input"
                                   id="agent_type_input"
                                   value="{{ agent_type_info.name | default_if_none:'' }}" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">Description</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control input-rounded" name="agent_type_description_input"
                                   id="agent_type_description_input"
                                   value="{{ agent_type_info.description | default_if_none:'' }}">

                        </div>
                    </div>

                    <div class="pull-right">
                        <a href="{% url 'agent_type:agent-type-list' %}">
                            <input id="agent_type_btn_back" class="btn btn-success" type="button" value="Back"/>
                        </a>
                        <a href="{% url 'agent_type:agent-type-update' agent_type_info.id %}">
                            <input id="agent_type_btn_save" class="btn btn-success" type="submit" value="Save"/ >
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>

<script>

function removeRedColor() {
    $('#agent_type_input').css('border-color', '');
}

function isValidName(name) {
    if (!name || (name == '')) {
        $('#agent_type_input').css('border-color', 'red');
        return false;
        }
    else {
        removeRedColor();
    }
    return true;
}

function saveAgentType() {

            var name = $("#agent_type_input").val();
            var description = $("#agent_type_description_input").val();

            if (!isValidName(name)) return;
            console.log('Show alert');
            swal({
                    title: "Are you sure you want to save agent type: " + name + "?",
                    type: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#2ECC71",
                    confirmButtonText: "OK",
                    cancelButtonText: "Cancel",
                    closeOnConfirm: true,
                    closeOnCancel: true
                },
                function (isConfirm) {
                    if (isConfirm) {
                        console.log("agent type to save: " + name)
                        var url = $("#agent_type_btn_save").data("url");
                        console.log(url)
                        $.ajax({
                            url: url,
                            type: "POST",
                            data: {'name': name, 'description': description},
                            dataType: "json",
                            beforeSend: function (xhr) {
                                xhr.setRequestHeader("X-CSRFToken", '{{ csrf_token }}');
                            },

                            success: function (response) {
                                var data = JSON.stringify(response); 
                                var json = $.parseJSON(data);
                                console.log('JSON: ' + json);

                                if (json.status.code == 'success') {
                                    console.log('Updated agent type ' + name);
                                } else {
                                    console.log('Error updating agent type ' + name);
                                }
                            },
                            error: function (err) {

                            }
                        });
                    }
                });
        }



</script>
{% endblock %}


{% block body_js %}
{{ block.super }}
<script src="{% static 'vendor/sweetalert/lib/sweet-alert.min.js' %}"></script>
{% endblock %}

